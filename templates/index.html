<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente Acad√©mico - UCE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #ffffff !important;
            color: #1e293b;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .app-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            grid-template-rows: 1fr auto;
            height: 100vh;
            background-color: #ffffff;
        }

        /* ===== SIDEBAR ESTILO STREAMLIT ===== */
        .sidebar {
            grid-column: 1;
            grid-row: 1 / 3;
            background-color: #f1f5f9 !important;
            border-right: 1px solid #e2e8f0;
            padding: 1.5rem;
            overflow-y: auto;
            color: #1e293b;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .logo-img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .sidebar-divider {
            height: 1px;
            background-color: #e2e8f0;
            margin: 1.5rem 0;
        }

        .sidebar-header {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .menu-radio {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .menu-option {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            color: #334155;
        }

        .menu-option:hover {
            background-color: #dbeafe;
            border-color: #2563eb;
        }

        .menu-option.selected {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .menu-option.selected span {
            color: white;
        }

        .menu-option input[type="radio"] {
            margin-right: 0.75rem;
            accent-color: #2563eb;
        }

        .clear-chat-btn {
            width: 100%;
            padding: 0.75rem;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 1rem;
            transition: background-color 0.2s;
        }

        .clear-chat-btn:hover {
            background-color: #1d4ed8;
        }

        .info-card {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.75rem;
        }

        .info-text {
            color: #334155;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .team-list {
            list-style: none;
            color: #334155;
            font-size: 0.9rem;
        }

        .team-list li {
            margin-bottom: 0.25rem;
            padding-left: 1rem;
            position: relative;
        }

        .team-list li::before {
            content: "‚Ä¢";
            color: #2563eb;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .algorithm-item {
            margin-bottom: 1rem;
        }

        .algorithm-name {
            font-weight: 600;
            color: #2563eb;
            margin-bottom: 0.25rem;
        }

        .algorithm-desc {
            color: #64748b;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .caption {
            color: #94a3b8;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 1rem;
        }

        /* ===== PANEL PRINCIPAL ===== */
        .main-panel {
            grid-column: 2;
            grid-row: 1;
            background-color: #ffffff;
            overflow-y: auto;
            padding: 2rem;
        }

        /* Welcome Header */
        .welcome-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            background-color: #f8fafc;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .avatar-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #dbeafe;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .welcome-text h1 {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .welcome-text p {
            color: #64748b;
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Chat Messages */
        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .message {
            max-width: 80%;
            padding: 1rem;
            border-radius: 12px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        .message.user {
            align-self: flex-end;
            background-color: #dbeafe;
            color: #1e293b;
            border-bottom-right-radius: 4px;
        }

        .message.assistant {
            align-self: flex-start;
            background-color: #f1f5f9;
            color: #1e293b;
            border-bottom-left-radius: 4px;
        }

        .message-time {
            font-size: 0.7rem;
            color: #94a3b8;
            margin-top: 0.25rem;
            text-align: right;
        }

        /* Admin Panel (Docente) */
        .admin-panel {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 2rem;
        }

        .admin-header {
            margin-bottom: 2rem;
        }

        .admin-header h1 {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .admin-header p {
            color: #94a3b8;
        }

        .password-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .db-actions {
            display: flex;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-secondary {
            background-color: #e2e8f0;
            color: #1e293b;
        }

        .btn-secondary:hover {
            background-color: #cbd5e1;
        }

        .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .file-uploader {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background-color: white;
            cursor: pointer;
            margin: 1.5rem 0;
        }

        .file-uploader:hover {
            border-color: #2563eb;
            background-color: #f8fafc;
        }

        /* ===== INPUT PANEL ===== */
        .input-panel {
            grid-column: 2;
            grid-row: 2;
            background-color: #ffffff;
            border-top: 1px solid #e2e8f0;
            padding: 1rem 2rem;
        }

        .chat-input-container {
            display: flex;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .chat-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .chat-input::placeholder {
            color: #64748b;
        }

        .send-btn {
            padding: 0.75rem 2rem;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .send-btn:hover {
            background-color: #1d4ed8;
        }

        /* Modales */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.visible {
            display: flex;
        }

        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 12px;
            width: 400px;
            max-width: 90%;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .modal-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
        }

        /* Animaciones */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- SIDEBAR (Estilo Streamlit) -->
        <div class="sidebar" id="sidebar">
            <!-- Logo UCE -->
            <div class="logo-container">
                <img src="/static/avatar_uce.png" alt="Logo UCE" class="logo-img" id="logoImg">
            </div>

            <div class="sidebar-divider"></div>

            <!-- Men√∫ Principal -->
            <div class="sidebar-header">Men√∫ Principal</div>
            <div class="menu-radio" id="menuRadio">
                <label class="menu-option selected" id="estudianteOption">
                    <input type="radio" name="perfil" value="estudiante" checked>
                    <span>üë®‚Äçüéì Estudiante (Consultas)</span>
                </label>
                <label class="menu-option" id="docenteOption">
                    <input type="radio" name="perfil" value="docente">
                    <span>üë®‚Äçüè´ Docente (Administraci√≥n)</span>
                </label>
            </div>

            <!-- Bot√≥n Limpiar Chat (solo visible en modo estudiante) -->
            <button class="clear-chat-btn" id="clearChatBtn">üßπ Limpiar Conversaci√≥n</button>

            <div class="sidebar-divider"></div>

            <!-- Informaci√≥n Acad√©mica -->
            <div class="info-card">
                <div class="info-title">üìö Informaci√≥n Acad√©mica</div>
                <div class="info-text">
                    <strong>Facultad:</strong> Ingenier√≠a<br>
                    <strong>Carrera:</strong> Ingenier√≠a en Sistemas<br>
                    <strong>Materia:</strong> Sistemas Operativos 2
                </div>
            </div>

            <!-- Equipo Desarrollador -->
            <div class="info-card">
                <div class="info-title">üë• Equipo Desarrollador</div>
                <ul class="team-list">
                    <li>Jose Cuadro</li>
                    <li>Jostin Lemache</li>
                    <li>Steven Ortiz</li>
                    <li>Darwin Toapanta</li>
                    <li>Josue Vizcaino</li>
                </ul>
            </div>

            <!-- Algoritmos Implementados -->
            <div class="info-card">
                <div class="info-title">‚öôÔ∏è Algoritmos Implementados</div>

                <div class="algorithm-item">
                    <div class="algorithm-name">Regresi√≥n Lineal</div>
                    <div class="algorithm-desc">An√°lisis de patrones en consultas para identificar tendencias y mejorar
                        respuestas bas√°ndose en el historial de interacciones.</div>
                </div>

                <div class="algorithm-item">
                    <div class="algorithm-name">RAG (Retrieval-Augmented Generation)</div>
                    <div class="algorithm-desc">Utiliza similitud de coseno en embeddings vectoriales para recuperar
                        informaci√≥n precisa de los documentos PDF.</div>
                </div>

                <div class="algorithm-item">
                    <div class="algorithm-name">An√°lisis de Embeddings</div>
                    <div class="algorithm-desc">Transformaci√≥n de texto en vectores num√©ricos de alta dimensi√≥n para
                        comprensi√≥n sem√°ntica contextual.</div>
                </div>
            </div>

            <div class="caption">Facultad de Ingenier√≠a - UCE 2026</div>
        </div>

        <!-- PANEL PRINCIPAL (Contenido din√°mico) -->
        <div class="main-panel" id="mainPanel">
            <!-- Vista Estudiante (por defecto) -->
            <div id="estudianteView">
                <!-- Welcome Header con Avatar -->
                <div class="welcome-header">
                    <div class="avatar-container">
                        <img src="/static/avatar_uce.png" alt="Lumen" class="avatar-img" id="avatarImg">
                    </div>
                    <div class="welcome-text">
                        <h1>Hola, soy ChatBot UCE</h1>
                        <p>Tu asistente virtual inteligente para el curso de IA. Estoy aqu√≠ para ayudarte a resolver
                            dudas sobre los m√≥dulos del curso.</p>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="chat-messages" id="chatMessages">
                    <!-- Los mensajes se insertar√°n aqu√≠ din√°micamente -->
                </div>
            </div>

            <!-- Vista Docente (oculta por defecto) -->
            <div id="docenteView" style="display: none;">
                <div class="admin-panel">
                    <div class="admin-header">
                        <h1>Panel Docente</h1>
                        <p>Gesti√≥n de M√≥dulos del Curso</p>
                    </div>

                    <p>Cargue los s√≠labos y m√≥dulos PDF para actualizar el conocimiento del asistente.</p>

                    <input type="password" class="password-input" id="adminPassword" placeholder="Clave de Acceso:">

                    <div
                        style="background-color: #fff3cd; color: #856404; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        ‚ö†Ô∏è IMPORTANTE: Si cambi√≥ de Ollama a Groq, debe limpiar la base de datos antigua primero.
                    </div>

                    <div class="db-actions">
                        <button class="btn btn-secondary" id="cleanDbBtn">üóëÔ∏è Limpiar Base de Datos</button>
                        <button class="btn btn-primary" id="checkDbBtn">üîç Verificar Estado</button>
                    </div>

                    <div id="dbStatus" style="margin: 1rem 0; padding: 0.5rem; border-radius: 4px; display: none;">
                    </div>

                    <div class="file-uploader" id="fileUploader">
                        üìÇ Arrastra tus archivos PDF aqu√≠ o haz click para seleccionar
                    </div>
                    <input type="file" id="fileInput" multiple accept=".pdf" style="display: none;">

                    <div id="fileList" style="margin: 1rem 0;"></div>

                    <button class="btn btn-primary" id="processPdfsBtn" style="width: 100%;">üöÄ Procesar y Actualizar
                        IA</button>
                </div>
            </div>
        </div>

        <!-- INPUT PANEL -->
        <div class="input-panel" id="inputPanel">
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="messageInput"
                    placeholder="Ej: ¬øQu√© temas aborda el M√≥dulo 1?">
                <button class="send-btn" id="sendBtn">Enviar</button>
            </div>
        </div>
    </div>

    <!-- Modal Login Admin -->
    <div class="modal" id="adminModal">
        <div class="modal-content">
            <div class="modal-title">üîê Acceso Docente</div>
            <p style="color: #64748b; margin-bottom: 1rem;">Ingrese la clave de acceso:</p>
            <input type="password" class="modal-input" id="modalPassword" placeholder="Contrase√±a">
            <div class="modal-buttons">
                <button class="btn btn-primary" id="modalLoginBtn">Acceder</button>
                <button class="btn btn-secondary" id="modalCancelBtn">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Estado de la aplicaci√≥n
        let currentView = 'estudiante';
        let isAdmin = false;
        let chatMessages = [];

        // Elementos DOM
        const estudianteOption = document.getElementById('estudianteOption');
        const docenteOption = document.getElementById('docenteOption');
        const estudianteView = document.getElementById('estudianteView');
        const docenteView = document.getElementById('docenteView');
        const clearChatBtn = document.getElementById('clearChatBtn');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const chatMessagesContainer = document.getElementById('chatMessages');
        const adminModal = document.getElementById('adminModal');
        const modalPassword = document.getElementById('modalPassword');
        const modalLoginBtn = document.getElementById('modalLoginBtn');
        const modalCancelBtn = document.getElementById('modalCancelBtn');

        // Elementos admin
        const adminPassword = document.getElementById('adminPassword');
        const cleanDbBtn = document.getElementById('cleanDbBtn');
        const checkDbBtn = document.getElementById('checkDbBtn');
        const dbStatus = document.getElementById('dbStatus');
        const fileUploader = document.getElementById('fileUploader');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const processPdfsBtn = document.getElementById('processPdfsBtn');

        // Manejo de vistas
        estudianteOption.addEventListener('click', () => {
            document.querySelectorAll('.menu-option').forEach(opt => opt.classList.remove('selected'));
            estudianteOption.classList.add('selected');
            estudianteOption.querySelector('input').checked = true;

            estudianteView.style.display = 'block';
            docenteView.style.display = 'none';
            currentView = 'estudiante';
        });

        docenteOption.addEventListener('click', () => {
            document.querySelectorAll('.menu-option').forEach(opt => opt.classList.remove('selected'));
            docenteOption.classList.add('selected');
            docenteOption.querySelector('input').checked = true;

            if (!isAdmin) {
                adminModal.classList.add('visible');
                return;
            }

            estudianteView.style.display = 'none';
            docenteView.style.display = 'block';
            currentView = 'docente';
        });

        // Modal login
        modalLoginBtn.addEventListener('click', () => {
            if (modalPassword.value === 'uce2026') {
                isAdmin = true;
                adminModal.classList.remove('visible');
                estudianteView.style.display = 'none';
                docenteView.style.display = 'block';
                currentView = 'docente';
                modalPassword.value = '';
            } else {
                alert('Contrase√±a incorrecta');
            }
        });

        modalCancelBtn.addEventListener('click', () => {
            adminModal.classList.remove('visible');
            // Volver a seleccionar estudiante
            document.querySelectorAll('.menu-option').forEach(opt => opt.classList.remove('selected'));
            estudianteOption.classList.add('selected');
            estudianteOption.querySelector('input').checked = true;
        });

        // Limpiar chat
        clearChatBtn.addEventListener('click', () => {
            chatMessages = [];
            renderMessages();
        });

        // Enviar mensaje
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Agregar mensaje usuario
            chatMessages.push({
                role: 'user',
                content: message,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            });

            messageInput.value = '';
            renderMessages();

            // Simular respuesta (esto se conectar√≠a con tu API)
            setTimeout(() => {
                chatMessages.push({
                    role: 'assistant',
                    content: 'Esta es una respuesta de ejemplo. En producci√≥n, esto vendr√≠a de tu API.',
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                });
                renderMessages();
            }, 1000);
        }

        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Renderizar mensajes
        function renderMessages() {
            chatMessagesContainer.innerHTML = '';
            chatMessages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${msg.role}`;
                messageDiv.innerHTML = `
                    <div class="message-content">${msg.content.replace(/\n/g, '<br>')}</div>
                    <div class="message-time">${msg.time}</div>
                `;
                chatMessagesContainer.appendChild(messageDiv);
            });
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }

        // File uploader
        fileUploader.addEventListener('click', () => {
            fileInput.click();
        });

        fileUploader.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileUploader.style.borderColor = '#2563eb';
            fileUploader.style.backgroundColor = '#f8fafc';
        });

        fileUploader.addEventListener('dragleave', () => {
            fileUploader.style.borderColor = '#cbd5e1';
            fileUploader.style.backgroundColor = 'white';
        });

        fileUploader.addEventListener('drop', (e) => {
            e.preventDefault();
            fileUploader.style.borderColor = '#cbd5e1';
            fileUploader.style.backgroundColor = 'white';

            const files = e.dataTransfer.files;
            handleFiles(files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            fileList.innerHTML = '';
            Array.from(files).forEach(file => {
                const fileDiv = document.createElement('div');
                fileDiv.style.padding = '0.5rem';
                fileDiv.style.borderBottom = '1px solid #e2e8f0';
                fileDiv.textContent = `üìÑ ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                fileList.appendChild(fileDiv);
            });
        }

        // Admin actions
        cleanDbBtn.addEventListener('click', () => {
            if (confirm('¬øEst√° seguro de limpiar la base de datos?')) {
                dbStatus.style.display = 'block';
                dbStatus.style.backgroundColor = '#d4edda';
                dbStatus.style.color = '#155724';
                dbStatus.textContent = '‚úÖ Base de datos eliminada correctamente';
            }
        });

        checkDbBtn.addEventListener('click', () => {
            dbStatus.style.display = 'block';
            dbStatus.style.backgroundColor = '#cce5ff';
            dbStatus.style.color = '#004085';
            dbStatus.textContent = '‚ÑπÔ∏è Estado BD: Existe (simulado)';
        });

        processPdfsBtn.addEventListener('click', () => {
            if (adminPassword.value !== 'uce2026') {
                alert('Clave de acceso incorrecta');
                return;
            }

            dbStatus.style.display = 'block';
            dbStatus.style.backgroundColor = '#fff3cd';
            dbStatus.style.color = '#856404';
            dbStatus.textContent = '‚è≥ Procesando documentos...';

            setTimeout(() => {
                dbStatus.style.backgroundColor = '#d4edda';
                dbStatus.style.color = '#155724';
                dbStatus.textContent = '‚úÖ Base de datos actualizada correctamente';
            }, 3000);
        });

        // Inicializar
        renderMessages();
    </script>
</body>

</html>
